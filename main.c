/******************************************************************************/
/* Files to Include                                                           */
/******************************************************************************/


// #pragma config statements should precede project file includes.
// Use project enums instead of #define for ON and OFF.


#if defined(__XC)
    #include <xc.h>        /* XC8 General Include File */
#elif defined(HI_TECH_C)
    #include <htc.h>       /* HiTech General Include File */
#elif defined(__18CXX)
    #include <p18cxxx.h>   /* C18 General Include File */
#endif

#if defined(__XC) || defined(HI_TECH_C)

#include <stdint.h>        /* For uint8_t definition */
#include <stdbool.h>       /* For true/false definition */

#endif

#include "system.h"        /* System funct/params, like osc/peripheral config */
#include "user.h"          /* User funct/params, such as InitApp */


/******************************************************************************/
/* User Global Variable Declaration                                           */
/******************************************************************************/

/* i.e. uint8_t <variable_name>; */

/******************************************************************************/
/* Main Program                                                               */
/******************************************************************************/

unsigned char joy_a = 0xFF;
unsigned char joy_b = 0xFF;

void readjoy()
{ 
	joy_a = 0xFF;
	joy_b = 0xFF;
	
	// only changes joy_a at this point!!!
  
	PORTB = 0x07; // might interfere with TX/RX???
	PORTB = 0x0B;
	
	for (unsigned char i=0x00; i<0x06; i++)
	{
		joy_a = joy_a << 1;
		if (RB5 != 0) joy_a = joy_a | 0x01;
		PORTB = 0x0F;
		PORTB = 0x0B;
	}
	
	PORTB = 0x17;
	PORTB = 0x1B;
	
	for (unsigned char i=0x00; i<0x06; i++)
	{
		joy_a = joy_a << 1;
		if (RB5 != 0) joy_a = joy_a | 0x01;
		PORTB = 0x1F;
		PORTB = 0x1B;
	}
	
	PORTB = 0x03;
}

char receivechar(void)
{
	while (RCIF == 0) { } // wait to receive character
	RCIF = 0; // clear flag

	return RCREG;
}

void transmitchar(char value)
{
	while (TXIF == 0) { } // wait to transmit character
	TXIF = 0; // clear flag

	TXREG = value;
}

void highaddr(unsigned char value)
{
	PORTC = value;
	PORTB = 0x01; // might interfere with TX/RX???
	PORTB = 0x03;
}

void lowaddr(unsigned char value)
{
	PORTC = value;
}

void writedata(unsigned char value)
{
	PMDOUT1L = value;
	PORTB = 0x02; // might interfere with TX/RX???
	PORTB = 0x02; // again?
	PORTB = 0x02; // again??
	PORTB = 0x02; // again???
	PORTB = 0x03;
}

unsigned char readdata()
{
	return PMDIN1L;
}

const unsigned char bitmap[2048] = {
	0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
	0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
	0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
	0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
	0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
	0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
	0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
	0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
	0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
	0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
	0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
	0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
	0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
	0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
	0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
	0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
	0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
	0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
	0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
	0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
	0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
	0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
	0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
	0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
	0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
	0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
	0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
	0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
	0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
	0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
	0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
	0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
	0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
	0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
	0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
	0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
	0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
	0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
	0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
	0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
	0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
	0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
	0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
	0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
	0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
	0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
	0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
	0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
	0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
	0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
	0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
	0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
	0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
	0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
	0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
	0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
	0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
	0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
	0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
	0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
	0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
	0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
	0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
	0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
	0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
	0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
	0x0F,0x00,0x3F,0xC0,0x3F,0xC0,0x3F,0xC0,
	0x0F,0x00,0x00,0x00,0x0F,0x00,0x00,0x00,
	0x0C,0x30,0x30,0xC0,0x3C,0xF0,0x3C,0xF0,
	0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
	0x3C,0xF0,0xFF,0xFC,0x3C,0xF0,0x3C,0xF0,
	0x3C,0xF0,0xFF,0xFC,0x3C,0xF0,0x00,0x00,
	0x03,0x00,0x3F,0xFC,0xF3,0x00,0x3F,0xF0,
	0x03,0x3C,0xFF,0xF0,0x03,0x00,0x00,0x00,
	0x30,0x0C,0xCC,0x3C,0x30,0xF0,0x03,0xC0,
	0x0F,0x30,0x3C,0xCC,0xF0,0x30,0x00,0x00,
	0x3F,0x00,0xF3,0xC0,0x3F,0x00,0xF3,0xCC,
	0xF0,0xFC,0xF0,0x3C,0x3F,0xF0,0x00,0x00,
	0x0F,0x00,0x0F,0x00,0x03,0x00,0x0C,0x00,
	0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
	0x03,0xF0,0x0F,0x00,0x3C,0x00,0x3C,0x00,
	0x3C,0x00,0x0F,0x00,0x03,0xF0,0x00,0x00,
	0x3F,0x00,0x03,0xC0,0x00,0xF0,0x00,0xF0,
	0x00,0xF0,0x03,0xC0,0x3F,0x00,0x00,0x00,
	0x00,0x00,0x00,0x00,0x3C,0xF0,0x0F,0xC0,
	0x3C,0xF0,0x00,0x00,0x00,0x00,0x00,0x00,
	0x00,0x00,0x00,0x00,0x03,0x00,0x03,0x00,
	0x3F,0xF0,0x03,0x00,0x03,0x00,0x00,0x00,
	0x00,0x00,0x00,0x00,0x00,0x00,0x0F,0x00,
	0x0F,0x00,0x03,0x00,0x0C,0x00,0x00,0x00,
	0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
	0x3F,0xF0,0x00,0x00,0x00,0x00,0x00,0x00,
	0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
	0x00,0x00,0x0F,0x00,0x0F,0x00,0x00,0x00,
	0x00,0x30,0x00,0xF0,0x03,0xC0,0x0F,0x00,
	0x3C,0x00,0xF0,0x00,0xC0,0x00,0x00,0x00,
	0x3F,0xF0,0xF0,0x3C,0xF0,0xFC,0xF3,0x3C,
	0xFC,0x3C,0xF0,0x3C,0x3F,0xF0,0x00,0x00,
	0xFF,0xC0,0x0F,0xC0,0x0F,0xC0,0x0F,0xC0,
	0x0F,0xC0,0x0F,0xC0,0xFF,0xFC,0x00,0x00,
	0x3F,0xF0,0xF0,0x3C,0x00,0xF0,0x0F,0xC0,
	0x3C,0x00,0xF0,0x00,0xFF,0xFC,0x00,0x00,
	0x3F,0xF0,0xF0,0x3C,0x00,0x3C,0x0F,0xF0,
	0x00,0x3C,0xF0,0x3C,0x3F,0xF0,0x00,0x00,
	0x03,0xFC,0x0F,0x3C,0x3C,0x3C,0xF0,0x3C,
	0xFF,0xFC,0x00,0x3C,0x00,0x3C,0x00,0x00,
	0xFF,0xFC,0xF0,0x00,0xFF,0xF0,0x00,0x3C,
	0x00,0x3C,0xF0,0x3C,0x3F,0xF0,0x00,0x00,
	0x3F,0xF0,0xF0,0x3C,0xF0,0x00,0xFF,0xF0,
	0xF0,0x3C,0xF0,0x3C,0x3F,0xF0,0x00,0x00,
	0xFF,0xFC,0xF0,0x3C,0x00,0xF0,0x03,0xC0,
	0x0F,0x00,0x3C,0x00,0xF0,0x00,0x00,0x00,
	0x3F,0xF0,0xF0,0x3C,0xF0,0x3C,0x3F,0xF0,
	0xF0,0x3C,0xF0,0x3C,0x3F,0xF0,0x00,0x00,
	0x3F,0xF0,0xF0,0x3C,0xF0,0x3C,0x3F,0xFC,
	0x00,0x3C,0xF0,0x3C,0x3F,0xF0,0x00,0x00,
	0x00,0x00,0x0F,0x00,0x00,0x00,0x00,0x00,
	0x00,0x00,0x0F,0x00,0x00,0x00,0x00,0x00,
	0x00,0x00,0x0F,0x00,0x00,0x00,0x00,0x00,
	0x0F,0x00,0x0F,0x00,0x3C,0x00,0x00,0x00,
	0x00,0x00,0x00,0x00,0x03,0xF0,0x0F,0xC0,
	0x3F,0x00,0x0F,0xC0,0x03,0xF0,0x00,0x00,
	0x00,0x00,0x00,0x00,0x00,0x00,0x3F,0xF0,
	0x00,0x00,0x3F,0xF0,0x00,0x00,0x00,0x00,
	0x00,0x00,0x00,0x00,0x3F,0x00,0x0F,0xC0,
	0x03,0xF0,0x0F,0xC0,0x3F,0x00,0x00,0x00,
	0x3F,0xF0,0xF0,0x3C,0x00,0x3C,0x0F,0xF0,
	0x0F,0x00,0x00,0x00,0x0F,0x00,0x00,0x00,
	0x3F,0xF0,0xF0,0x3C,0xF3,0x3C,0xF3,0x3C,
	0xF3,0xF0,0xF0,0x00,0x3F,0xF0,0x00,0x00,
	0x0F,0xC0,0x3C,0xF0,0xF0,0x3C,0xF0,0x3C,
	0xFF,0xFC,0xF0,0x3C,0xF0,0x3C,0x00,0x00,
	0xFF,0xF0,0xF0,0x3C,0xF0,0x3C,0xFF,0xF0,
	0xF0,0x3C,0xF0,0x3C,0xFF,0xF0,0x00,0x00,
	0x3F,0xF0,0xF0,0x3C,0xF0,0x00,0xF0,0x00,
	0xF0,0x00,0xF0,0x3C,0x3F,0xF0,0x00,0x00,
	0xFF,0xC0,0xF0,0xF0,0xF0,0x3C,0xF0,0x3C,
	0xF0,0x3C,0xF0,0xF0,0xFF,0xC0,0x00,0x00,
	0xFF,0xFC,0xF0,0x00,0xF0,0x00,0xFF,0xC0,
	0xF0,0x00,0xF0,0x00,0xFF,0xFC,0x00,0x00,
	0xFF,0xFC,0xF0,0x00,0xF0,0x00,0xFF,0xC0,
	0xF0,0x00,0xF0,0x00,0xF0,0x00,0x00,0x00,
	0x3F,0xFC,0xF0,0x00,0xF0,0x00,0xF3,0xFC,
	0xF0,0x3C,0xF0,0x3C,0x3F,0xFC,0x00,0x00,
	0xF0,0x3C,0xF0,0x3C,0xF0,0x3C,0xFF,0xFC,
	0xF0,0x3C,0xF0,0x3C,0xF0,0x3C,0x00,0x00,
	0xFF,0xFC,0x0F,0xC0,0x0F,0xC0,0x0F,0xC0,
	0x0F,0xC0,0x0F,0xC0,0xFF,0xFC,0x00,0x00,
	0x03,0xFC,0x00,0x3C,0x00,0x3C,0x00,0x3C,
	0xF0,0x3C,0xF0,0x3C,0x3F,0xF0,0x00,0x00,
	0xF0,0x3C,0xF0,0xF0,0xF3,0xC0,0xFF,0x00,
	0xF3,0xC0,0xF0,0xF0,0xF0,0x3C,0x00,0x00,
	0xF0,0x00,0xF0,0x00,0xF0,0x00,0xF0,0x00,
	0xF0,0x00,0xF0,0x00,0xFF,0xFC,0x00,0x00,
	0xF0,0x3C,0xFC,0xFC,0xFF,0xFC,0xF3,0x3C,
	0xF0,0x3C,0xF0,0x3C,0xF0,0x3C,0x00,0x00,
	0xF0,0x3C,0xFC,0x3C,0xFF,0x3C,0xF3,0xFC,
	0xF0,0xFC,0xF0,0x3C,0xF0,0x3C,0x00,0x00,
	0x3F,0xF0,0xF0,0x3C,0xF0,0x3C,0xF0,0x3C,
	0xF0,0x3C,0xF0,0x3C,0x3F,0xF0,0x00,0x00,
	0xFF,0xF0,0xF0,0x3C,0xF0,0x3C,0xFF,0xF0,
	0xF0,0x00,0xF0,0x00,0xF0,0x00,0x00,0x00,
	0x3F,0xF0,0xF0,0x3C,0xF0,0x3C,0xF0,0x3C,
	0xF3,0xFC,0xF0,0xF0,0x3F,0xCC,0x00,0x00,
	0xFF,0xF0,0xF0,0x3C,0xF0,0x3C,0xFF,0xF0,
	0xF3,0xC0,0xF0,0xF0,0xF0,0x3C,0x00,0x00,
	0x3F,0xF0,0xF0,0x3C,0xF0,0x00,0x3F,0xF0,
	0x00,0x3C,0xF0,0x3C,0x3F,0xF0,0x00,0x00,
	0xFF,0xFC,0x0F,0xC0,0x0F,0xC0,0x0F,0xC0,
	0x0F,0xC0,0x0F,0xC0,0x0F,0xC0,0x00,0x00,
	0xF0,0x3C,0xF0,0x3C,0xF0,0x3C,0xF0,0x3C,
	0xF0,0x3C,0xF0,0x3C,0x3F,0xF0,0x00,0x00,
	0xF0,0x3C,0xF0,0x3C,0xF0,0x3C,0xF0,0x3C,
	0x3C,0xF0,0x0F,0xC0,0x03,0x00,0x00,0x00,
	0xF0,0x3C,0xF0,0x3C,0xF3,0x3C,0xFF,0xFC,
	0xFC,0xFC,0xF0,0x3C,0xF0,0x3C,0x00,0x00,
	0xF0,0x3C,0xFC,0xFC,0x3F,0xF0,0x0F,0xC0,
	0x3F,0xF0,0xFC,0xFC,0xF0,0x3C,0x00,0x00,
	0xF0,0x3C,0xF0,0x3C,0xF0,0x3C,0x3F,0xF0,
	0x0F,0xC0,0x0F,0xC0,0x0F,0xC0,0x00,0x00,
	0xFF,0xFC,0x00,0xFC,0x03,0xF0,0x0F,0xC0,
	0x3F,0x00,0xFC,0x00,0xFF,0xFC,0x00,0x00,
	0x3F,0xF0,0x3C,0x00,0x3C,0x00,0x3C,0x00,
	0x3C,0x00,0x3C,0x00,0x3F,0xF0,0x00,0x00,
	0x30,0x00,0x3C,0x00,0x0F,0x00,0x03,0xC0,
	0x00,0xF0,0x00,0x3C,0x00,0x0C,0x00,0x00,
	0x3F,0xF0,0x00,0xF0,0x00,0xF0,0x00,0xF0,
	0x00,0xF0,0x00,0xF0,0x3F,0xF0,0x00,0x00,
	0x03,0x00,0x0F,0xC0,0x3C,0xF0,0xF0,0x3C,
	0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
	0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
	0x00,0x00,0x00,0x00,0xFF,0xFC,0x00,0x00,
	0x0C,0x00,0x03,0x00,0x00,0x00,0x00,0x00,
	0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
	0x00,0x00,0x00,0x00,0x3F,0xF0,0x00,0x3C,
	0x3F,0xFC,0xF0,0x3C,0x3F,0xFC,0x00,0x00,
	0xF0,0x00,0xF0,0x00,0xFF,0xF0,0xF0,0x3C,
	0xF0,0x3C,0xF0,0x3C,0xFF,0xF0,0x00,0x00,
	0x00,0x00,0x00,0x00,0x3F,0xF0,0xF0,0x3C,
	0xF0,0x00,0xF0,0x3C,0x3F,0xF0,0x00,0x00,
	0x00,0x3C,0x00,0x3C,0x3F,0xFC,0xF0,0x3C,
	0xF0,0x3C,0xF0,0x3C,0x3F,0xFC,0x00,0x00,
	0x00,0x00,0x00,0x00,0x3F,0xF0,0xF0,0x3C,
	0xFF,0xFC,0xF0,0x00,0x3F,0xF0,0x00,0x00,
	0x0F,0xF0,0x0F,0x00,0xFF,0xFC,0x0F,0x00,
	0x0F,0x00,0x0F,0x00,0x0F,0x00,0x00,0x00,
	0x00,0x00,0x00,0x00,0x3F,0xFC,0xF0,0x3C,
	0x3F,0xFC,0x00,0x3C,0x3F,0xF0,0x00,0x00,
	0xF0,0x00,0xF0,0x00,0xFF,0xF0,0xF0,0x3C,
	0xF0,0x3C,0xF0,0x3C,0xF0,0x3C,0x00,0x00,
	0x03,0xC0,0x00,0x00,0x3F,0xC0,0x03,0xC0,
	0x03,0xC0,0x03,0xC0,0xFF,0xFC,0x00,0x00,
	0x00,0x3C,0x00,0x00,0x00,0x3C,0x00,0x3C,
	0x00,0x3C,0xF0,0x3C,0x3F,0xF0,0x00,0x00,
	0xF0,0x00,0xF0,0x00,0xF0,0x3C,0xF0,0xF0,
	0xFF,0xC0,0xF0,0xF0,0xF0,0x3C,0x00,0x00,
	0xF0,0x00,0xF0,0x00,0xF0,0x00,0xF0,0x00,
	0xF0,0x00,0x3F,0x00,0x03,0xFC,0x00,0x00,
	0x00,0x00,0x00,0x00,0xFF,0xF0,0xF3,0x3C,
	0xF3,0x3C,0xF3,0x3C,0xF3,0x3C,0x00,0x00,
	0x00,0x00,0x00,0x00,0xFF,0xF0,0xF0,0x3C,
	0xF0,0x3C,0xF0,0x3C,0xF0,0x3C,0x00,0x00,
	0x00,0x00,0x00,0x00,0x3F,0xF0,0xF0,0x3C,
	0xF0,0x3C,0xF0,0x3C,0x3F,0xF0,0x00,0x00,
	0x00,0x00,0x00,0x00,0xFF,0xF0,0xF0,0x3C,
	0xFF,0xF0,0xF0,0x00,0xF0,0x00,0x00,0x00,
	0x00,0x00,0x00,0x00,0x3F,0xFC,0xF0,0x3C,
	0x3F,0xFC,0x00,0x3C,0x00,0x3C,0x00,0x00,
	0x00,0x00,0x00,0x00,0xF3,0xF0,0xFC,0x3C,
	0xF0,0x00,0xF0,0x00,0xF0,0x00,0x00,0x00,
	0x00,0x00,0x00,0x00,0x3F,0xFC,0xF0,0x00,
	0xFF,0xFC,0x00,0x3C,0xFF,0xF0,0x00,0x00,
	0x0F,0x00,0x0F,0x00,0xFF,0xFC,0x0F,0x00,
	0x0F,0x00,0x0F,0x00,0x0F,0xFC,0x00,0x00,
	0x00,0x00,0x00,0x00,0xF0,0x3C,0xF0,0x3C,
	0xF0,0x3C,0xF0,0x3C,0x3F,0xF0,0x00,0x00,
	0x00,0x00,0x00,0x00,0xF0,0x3C,0xF0,0x3C,
	0x3C,0xF0,0x0F,0xC0,0x03,0x00,0x00,0x00,
	0x00,0x00,0x00,0x00,0xF0,0x3C,0xF3,0x3C,
	0xF3,0x3C,0xFF,0xFC,0x3C,0xF0,0x00,0x00,
	0x00,0x00,0x00,0x00,0xFC,0xFC,0x3F,0xF0,
	0x0F,0xC0,0x3F,0xF0,0xFC,0xFC,0x00,0x00,
	0x00,0x00,0x00,0x00,0xF0,0x3C,0xF0,0x3C,
	0x3C,0xF0,0x0F,0xC0,0xFF,0x00,0x00,0x00,
	0x00,0x00,0x00,0x00,0xFF,0xFC,0x03,0xF0,
	0x0F,0xC0,0x3F,0x00,0xFF,0xFC,0x00,0x00,
	0x03,0xF0,0x0F,0x00,0x0F,0x00,0x3F,0x00,
	0x0F,0x00,0x0F,0x00,0x03,0xF0,0x00,0x00,
	0x0F,0x00,0x0F,0x00,0x0F,0x00,0x0F,0x00,
	0x0F,0x00,0x0F,0x00,0x0F,0x00,0x00,0x00,
	0x3F,0x00,0x03,0xC0,0x03,0xC0,0x03,0xF0,
	0x03,0xC0,0x03,0xC0,0x3F,0x00,0x00,0x00,
	0x00,0x00,0x00,0x00,0x00,0x00,0x3F,0x3C,
	0xF3,0x3C,0xF3,0xF0,0x00,0x00,0x00,0x00,
	0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
	0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00
};

void display(unsigned char x, unsigned char y, unsigned char value)
{
	unsigned int pos = (unsigned int)(value) * 16;
	unsigned char low = x * 2;
	unsigned char high = y * 4;
	
	highaddr(high);
	high++;
	lowaddr(low);
	low++;
  
	for (unsigned char i=0; i<4; i++)
	{
		writedata(bitmap[pos]);
		pos++;
		lowaddr(low);
		low += 0x7F;
		writedata(bitmap[pos]);
		pos++;
		lowaddr(low);
		low++;
		writedata(bitmap[pos]);
		pos++;
		lowaddr(low);
		low = x * 2;
		writedata(bitmap[pos]);
		pos++;
		highaddr(high);
		high++;
		lowaddr(low);
		low++;
	}
}

void main(void)
{
    /* Configure the oscillator for the device */
    ConfigureOscillator();

    /* Initialize I/O and Peripherals for application */
    InitApp();

    /* TODO <INSERT USER APPLICATION CODE HERE> */

	// setup initial tri-state and output levels
	PORTA = 0x00;
	LATA = 0x00;
    TRISA = 0xFF;
	PORTB = 0x03;
	LATB = 0x00;
	TRISB = 0xE0;
	PORTC = 0x00;
	LATC = 0x00;
	TRISC = 0x00;
	PORTD = 0x00;
	LATD = 0x00;
	TRISD = 0xFF;
	PORTE = 0x00;
	LATE = 0x00;
	TRISE = 0xFF; // or 0xF0
	
	// disable interrupts
	INTCON = 0x00;
	INTCON2 = 0x80;
	INTCON3 = 0x00;
	PIE1 = 0x00;
	PIE2 = 0x00;
	PIE3 = 0x00;
	PIE4 = 0x00;
	PIE5 = 0x00;
	
	// disable analog for digital I/O
	ANCON0 = 0xFF;
	ANCON1 = 0x1F;
	
	// disable open drain and use TTL on PMP
	ODCON1 = 0x00;
	ODCON2 = 0x00;
	ODCON3 = 0x00;
	PADCFG1 = 0x05;

	// setup internal oscillator to 8 MHz
	//OSCCON = 0x74;
	
	// setup Parallel Master/Slave Port
	PMCONH = 0x00; // disable everything
	PMCONL = 0x00; // low-enable
	PMMODEH = 0x00; 
	PMMODEL = 0x00;
    
	PMEH = 0x00;
	PMEL = 0x00;
	PMADDRH = 0x40; // 0x40?
	PMADDRL = 0x00;
	PMSTATH = 0x00;
	PMSTATL = 0x00;
	
	PMCONH = 0x87; // 0x87, re-enable everything
	PMCONL = 0x80; // 0x80?
	
	// small examples
	//PMDOUT1L = 0x55; // output on data bus
	//PORTA = PMDIN1L; // input from data bus

	/*
	// setup TX/RX on RB6/RP9 and RB7/RP10 respectively
	RPOR10 = 0x06; // TX2 on RP9
	RPINR16 = 0x0A; // RX2 on RP10
	TRISB = TRISB | 0x80; // make sure RX is input
	TRISB = TRISB & 0x40; // make sure TX is output
	TXSTA1 = 0x04; // disable TX1
	RCSTA1 = 0x10; // disable RX1
	SPBRG2 = 41; // set for 6.28 MHz, 6293750 / (16 * (9600 + 1))
	SPBRGH2 = 0; // set to zero
	BAUDCON2 = 0x32; // stay in 8-bit mode, inverted
	TXSTA2 = 0x24; // 'high speed' transmit enabled
	RCSTA2 = 0x90; // serial port enabled, continuous receives
	RCIF = 0; // clear flag
	TXIF = 0; // clear flag
	*/
	
	for (unsigned int i=0; i<128; i++)
	{
		highaddr((unsigned char)(i));
		
		for (unsigned int j=0; j<256; j++)
		{
			lowaddr((unsigned char)(j));
			writedata((unsigned char)(i) + (unsigned char)(j));
		}
	}
	
	display(0x00, 0x02, 'H');
	display(0x01, 0x02, 'E');
	display(0x02, 0x02, 'L');
	display(0x03, 0x02, 'L');
	display(0x04, 0x02, 'O');
	display(0x05, 0x02, ' ');
	display(0x06, 0x02, 'W');
	display(0x07, 0x02, 'O');
	display(0x08, 0x02, 'R');
	display(0x09, 0x02, 'L');
	display(0x0A, 0x02, 'D');
	display(0x0B, 0x02, '!');
	
	
	for (unsigned int i=0; i<32; i++)
	{
		for (unsigned int j=0; j<50; j++)
		{
			display((unsigned char)(j), (unsigned char)(i), (unsigned char)(i+j+32));
		}
	}
	
	highaddr(0x03);
	lowaddr(0x63 + 0x80);
	writedata(0xA5);
	
	
    while(1)
    {
		
		
        //PORTA = PORTA + 1; // just a test
        //__delay_ms(1000);
		
		//transmitchar('*');
    }
	

}

